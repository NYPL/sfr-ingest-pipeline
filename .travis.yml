dist: xenial
language: python
python:
  - '3.7'
jobs:
  include:
  - language: python
    python: 3.7
    install: "./runCommand.sh init func= lang=python"
    script:
      - "./runCommand.sh test func= lang=python"
  - language: node_js
    node_js: 10
    install: "./runCommand.sh init func= LANG=node.js"
    script:
      - "./runCommand.sh test func= LANG=node.js"
before_deploy:
  - cd app/sfr-search-api
  - git archive --format zip --output ../../sfr-search-api-dev.zip development ./
  - git archive --format zip --output ../../sfr-search-api-prod.zip beta-production ./
  - cd ../../
deploy:
  - provider: elasticbeanstalk
    skip_cleanup: true
    access_key_id: "$AWS_ACCESS_KEY_ID_DEVELOPMENT"
    secret_access_key: "$AWS_SECRET_ACCESS_KEY_DEVELOPMENT"
    region: us-east-1
    app: sfr-search-api
    env: sfr-search-api-dev
    bucket_name: elasticbeanstalk-us-east-1-224280085904
    bucket_path: sfr-search-api-development
    zip_file: sfr-search-api-dev.zip
    on:
      repo: NYPL/sfr-ingest-pipeline
      branch: development
  - provider: elasticbeanstalk
    skip_cleanup: true
    access_key_id: "$AWS_ACCESS_KEY_ID_PRODUCTION"
    secret_access_key: "$AWS_SECRET_ACCESS_KEY_PRODUCTION"
    region: us-east-1
    app: DigitalResearchBooks-search-api
    env: digital-research-books-api
    bucket_name: elasticbeanstalk-us-east-1-946183545209
    bucket_path: DigitalResearchBooks-search-api
    zip_file: sfr-search-api-prod.zip
    on:
      repo: NYPL/sfr-ingest-pipeline
      branch: development
env:
  global:
    - ELASTICSEARCH_INDEX: sfr
    - ELASTICSEARCH_INDEX_V2: sfr_test
    - ELASTICSEARCH_INDEX_V3: sfr_new_v3
    - secure: YYpfzClLBbODFOrvhEKAaOjWAUNrDMLX9TlouKd1bioHiKzG3sn0y8BWL6Sysnctz8fC178lJtGvFVeAxmY2J6iYjE/r9Tg6rG6UrTUBt4avRuGdUn4yIaoXmDQrpfhqYlcNcj3pCpVbqnl2pCPQp3BKBfrmOaM1+9kZAO2WztpRHcie8H2i9BVJ0h4CGaqxP00QyhIerE16HBFOi3+dmVCnEfjon2Oefh0/8aw5ojVftV7J/TZAI17YDoGUwnQAr3ue8+nU8egR8kIRyYVPu4W7V3ebBg2sKAfusgECIIu9f4JtalQRXtWcDI1jyZDKV+aKoPuzGeBE8GvuEVrC++ZdbhlPsVCHC63D5PcMPb7Dv/JU8dLFMi+qBkbF1ECMlOVN2QCVKittoyCOiQNnikru+5kNQbF24MKSXn0zh6EsEBCVHPzikCjsGOkXOjjkzQo6+jopalg0fdr51hQUrUCR6pFQ9eouThYeue9XIn6TUuMjMgFbyg1XsSb8HqmM6v3auSK8RlEJSCkmEl+LTMQyzlyrtA39S3KnVRIaK0HdT2cczi8MjhrBk7lw3ox9YdYujEfnfxu+2ekfiv8/2xEwuXCe/+DRIzeu3t+pXSUfSgOiCRDincsaaNTASuDRi9rGkwHAjk5BCWEIdtZRiqN2+Mx61o4/A7XZ9Xi1gjU=
    - secure: O97n1dxl5n6feSWHGqowjRnH+io2bZq/EMjuabYTh4ZhsI5Syu+5WKL4KPfrCZFB+L+PWp2ifmqMKFpNauLfIMlQq6KAqmTxHAIcxLl/pHrlNwFq9sVxPVD50eH7x7QEUzyAGsu0ydHAAhIUURUW3hjEXHQtK6TGP/OWbuxTXkFc6k+Dh7GdhtTfmRkwVFM5MX3gHyIRCMf9CFgMmql6DXtOOu0mDi3vCRCg0plLfcVuuBMW0AwHuKYeQDhgNn2fatwfZHFuhtVAXO72j2UTR6aFp+WFTJb9a5APqNMOJrjtvGvHJDDTQqty2TnHHg+Hr8HVU2GZ2L1qDkBxWpVMo35W6BGsnnbYKBrnKBG6Wn2ZQe7fijUr/ylAeeCEhyqHiCbYZqf+ydLBm7ZcRfg7cJLayavOgHhOKYGx04q/upgK1BPndTwTSpUL8My9AS5062YfMhi0t+YTW0ag5NHaJq9IzK6DlcmUNvtR65mftyt8rQrgdy3jT1WqBRaqp0pFvnyaQ94N7eZ9psAO+M8PMIkYM6mKZTq7WnTk1vaN2eiC2x8hFRN5RhMDO5Bwi+V5ckhq9psL3V0qeO1+w9WBauv74Twk6Hao4YXKNCDrbgbJTwom+smEIccEB6bZ4+uQrBljE+qqbtMp1T89qj4QewLmVKjTdieU0bgm4eFAxhI=
    - secure: kCwdSObLEdj3zjuI1mmVDVr8onnTBG8ViO83P3HpsOwWZ4FbPRCf0JUZzuQemoiSrXpf+Pz67UaO003aiLXNJXsIMrVNPafy7H3Fxw2V177q4zH8lTLm0Az7nDtO6dI/kP5rOX2nJsvLGg8q8BIXgK9RCqLnaqIQDK4TZtBNbhtF9Tsi2VEER9TzoHHxSn6XButa0p9HVqHJqqZTcdx+dGSuxMnupOmBG633ySec66LwDqrhlY2115aF82P+obzripZ3jUuAwLBsPayzRE5f67aeWI4sU1D7G+BoKGlzk2m0iRdNWHPs6kdglADzq1Ljco3gPpvN6Yf3rHVRDmhnrQgemsif8fuiqZSPG3bGSy+NMYDENZUvnJpoVd55z9wMwbtcm2lbyAHL8+qyC70OcttDehphlu8L3yOa2aIGhiyqr2cMZwwFnrLMqkri2BpYgmwQiWJKnR0Y7hiOmruNxa7Vkgipj9As4Ms2Fwe3VA8UHFJPrfsFSaxCJmsIU7SD5XevEdYstk0IJ6ClbN8WG/4OWX6EQiDCmLFKXjLh+Gv9c8dkVkeCIzHnBEUdw7hHU4s+ZAttWW77TFGnJFaeDAulzpZpvcwH7feReHa9KS2v5JIEmCedW9j6T6+GnPzuYXQxRaGp/WZLlIl+V17xfYeD3on8kW0clzxq24Z0xV8=
    - secure: Fq5hTEyBjc7STtLkQgCRwwXFg/GCHlqHeZ6DAvKG2oGtSQQYNmqZmFQHKEFSBYUxUdgF0qLPbw4yWGwPxV9XSdlTJgxZhsuRgiTrjlqq1bHmf6eg8SFhV2N96S1U0BPlIG1dO7VTciZ6coUrqg+jzx2jZT7eDW8FYCET02ft6EGZuIFVYjKg4fPuvLKIJXHM1Aomc0+jLhxidl6C+IwVtFprktzbRIPYb5SR9BL/sDyer+DXgO2XGHEw7kHO01ZUq8ePcsPEkwPpA5gKnuRk04mjKNILUxPJYb9dT32JOwutFX6UfHL2LfpVJ0f+eMZjt2NV89NzsLf5GBAwMxayfn6Bz/9jqTaABGQgeaNXRtLWWBfH55AIXhquNjAmZmgwJ+j3lXpF6rkcqKD1QA4MI6ElN4qojHi1jgRi0VpWWsjYwBI174JSVRxSAWmrDjJukjUdoKUrcYjzNp+tXORxig8RDsN5KwOw6pBL5Z/HjwcQKzv+1XYKCimt3FFzg4JjM+me7Cop9MXEV4tYiUDTORR+PHgHSHXR2GtLX8Csu2CF9o14CBfJmZj4pCp2y9MdUaGz9HrHaJ+mXYeU/jr4aluCqj8yXzXfzyt5HaE1Np6xR7d/G9ZUc7cQ+oj01uUU/c2h/UX9uq22SQvFB5HKlGnZTsfxHaChZ15vmpYHMjY=
    - secure: IjkIUa5oU4YvLg9zg3VCsr5YqNhBp9oi3V+GoXbRDVB6qBIg/1amHUvr53VVjgz48BO8ivtqyCbYP+uHHb+jMpE4vI3ZWPnw1MbU35st6H6xEX+2m4T5HuwRA6uT3rJiQHivtJJ9j6wQ8tOUqB3+Hz21bkxA+aG008d5PIOnVVu4irqvxwIxksPMnunMPqDSgU6IAiF66I3oFZfW2ccfrFRD7pY0u5VnkyGB5f1GkflvGw2bDXCGyyDSIIZrFiI/36nCVjIZ9GTsLttj7TyCkuJIj1HhPDw2Xqc92T0M2B3QB7rDLrAJT4aJeE/R/W1QbPYtBv9z7B+qp3eHvq5845AoBymRRrCbHcp8wh3vKSzebrbvhKbSGdy8o7GhOMbwitN+JvVPaNiAoXYYQYJi2DsjJZY5VG/LgjXY9ON5gpdSIWnxd+Ho6m2Rm/p6JQHudaD+aJJ9oht2qg81mBw/3plOaQFqWUeN+9kg6Zp32sWk6AXd9LCpC6praLsK+pVAcaa5ThnIZ85JcBC46rS3ZApAnhpOq2qakIDfgVya7xsgmhI1GuSR8XP5Ei9Y6tuQtQU8S1d+ROskccj3MpsSUDvnsoBvmofZqYk3xOnABWI0HkaKjGq36FqpxEfmtbuZqJCSb6Z/GIjL9vmUoR63hqyU64QYsXZQLCEAhmRhaHo=
    - secure: Tl5B7U5rvQb+CVjKVZHU2djBEN9DL7OQo2oUyApsBD30NEoVFcuxatxsOAzdsvitintP27xUAKGBdiCOgMqoqBFGMnNtvsnA5Z+8tqccXYThU6UG/7VZjuPSNifGt/cJkthmqOezuG4S3IfZtLhuvkhd6JF9odWmfOwtU06okKWnAZAE0VbDn+taA4Fx/KNLx/rdJuB+O/haCPFxaVV8egwtVhSKTXwnDXyzhxccutJJYIRD5Fh3NqzmcZ1HmtYblCiLpD8aPMLYOlycg9ndRqLVVooHZOgY2u4TOZ2p4J0/6AjU2pqScoY3Hji5DjM2eIAzoV4vR2VU8zF5aYRxGVisKOh3FcUzTrjFGzh49b3YY6VCFynuzl7gznwG8q5wZlEEp+G66X66wsSdSCQ7QwDxt0Shr28tu8ZNxP8yqRPkMhXAsx/LsM7w/KeFxCoXcmDTwrEUvcdNSmViTZqzv5iVnvFi5Ot/w3bj50Luh76zqSpvWCZiKdC1/S6fUE3J5hqYRio+Tjnv6r3XiPGrMhGp72qwebkTsB/psfYR7nPrPTTrNmMdxY0HI/IRY7VleizzTH37i+yNJBrHYh1jY8pTK8Ip3wWvM0ueZSyCtO0mEH76OKQV7JvlBIYC8inSH7IUW7UFmEFMD5dr39r0nu5riMD5AIf7sBcJh7xVFrk=
    - secure: phU708ickJkKZz597uNhzZFqnyW2a0ghv5CifMvk+j8RGJSFv93Y5oSgQuugkrdNtelqvYVJUp5Bo2aixW9N3gnaW/b7bNQMIqXVRH4P324Ab4eIRwEpEcjCiL0254Ga+8DfOurn+zY/7Tp3x63KgwBWoFBdADq2rRKnF3fJDAkfqNiuuiJ+lhFOn1065LiLzK0MpV9NKaAtLuTxGsyjcylp3ST+c1zDkj6FyifeZNSWMr2V5K5bb7H13SHNxUYhhTwmnF5D6fcbyato632iAXDzauvGxn4IARHd1sF9vSz8iNhle9uvnJC8jzUshjBeuP5fzEC5K3dx4cY978xAtKffybV5bvtq13vHfGbeCzugPLkNsEQ7ORsOHXKiM07efspof10XaXgYzUbuwok6JxPA7xdW4rVLSgDX0Q4mBOCoyvuDA4ApYw3jnfI2CSvcBrMDcWzi/BQg5pJuSRNp6VTqcQ5S7AvlQ5w1Old1B1VDq/Cttnb9JsrjwF34C0fLK6ysykSXQfR2qHVRXafCiiHk8Yv+Z8h+5RdKWSib5hF6qmiHzwb6MC4kgEf7+tJLPosL6zldg3BGenlVBW5WYSst0MdM7JcRIcPok8RQoxsVp5qjnML2TNxQ7imjEFLCyxhBvnFLOPpRly4ZPbbkIOGDtMk1UAxK9kpyYBBPNPk=
