dist: xenial
language: python
python:
- '3.7'
jobs:
  include:
  - language: python
    python: 3.7
    install: "./runCommand.sh init func= lang=python"
    script:
    - "./runCommand.sh test func= lang=python"
  - language: node_js
    node_js: 10
    install: "./runCommand.sh init func= LANG=node.js"
    script:
    - "./runCommand.sh test func= LANG=node.js"
before_deploy:
- cd app/sfr-search-api
- git fetch origin beta-production:beta-production
- git fetch origin development:development
- git archive --format zip --output ../../sfr-search-api-prod.zip beta-production
  ./
- git archive --format zip --output ../../sfr-search-api-dev.zip development ./
- cd ../../
deploy:
- provider: elasticbeanstalk
  skip_cleanup: true
  access_key_id: "$AWS_ACCESS_KEY_ID_PRODUCTION"
  secret_access_key: "$AWS_SECRET_ACCESS_KEY_PRODUCTION"
  region: us-east-1
  app: DigitalResearchBooks-search-api
  env: digital-research-books-api
  bucket_name: elasticbeanstalk-us-east-1-946183545209
  bucket_path: DigitalResearchBooks-search-api
  zip_file: sfr-search-api-prod.zip
  on:
    repo: NYPL/sfr-ingest-pipeline
    branch: beta-production
- provider: elasticbeanstalk
  skip_cleanup: true
  access_key_id: "$AWS_ACCESS_KEY_ID_DEVELOPMENT"
  secret_access_key: "$AWS_SECRET_ACCESS_KEY_DEVELOPMENT"
  region: us-east-1
  app: sfr-search-api
  env: sfr-search-api-dev
  bucket_name: elasticbeanstalk-us-east-1-224280085904
  bucket_path: sfr-search-api-development
  zip_file: sfr-search-api-dev.zip
  on:
    repo: NYPL/sfr-ingest-pipeline
    branch: development
env:
  global:
  - ELASTICSEARCH_INDEX: sfr
  - ELASTICSEARCH_INDEX_V2: sfr_test
  - ELASTICSEARCH_INDEX_V3: sfr_new_v3
  - secure: YyTp7NLlYvxkLZmTwoh4sjijdtj/UUab5r+xML7kkP9AfalcEgIP69i2uiinZuLzgM2uwbG6o3s1BYFUxD9nIRr4aPdDoU6oxvYKTDOexfcHc3jqa/HDwhHRAwDFtZF+bXnWQ+svA2tyyEGsE/S34CrkuVnrxHPoIQx8euQaq/XSXeVFshFY/xvJPif6ImZxCh9Q/kzKUURfMOK9U9MEcwTXUeWkX3rNRPhk8oRkEiteHWNjoy/QVschZOBz6OgUAUOEHG6ShCRBiMNdP05uj+xSRz+aLAHpOH9lVqmzDQEdV7TioijA/kmo5epG9VehHPWki6VjwpuXbgQCetpwsKCC5kK3OC9kAAPBnaClTedClhvEXw3a3w9SaQajy48UKPvDdyuC+oXMr5icMiZfFCWc/LYRqznz6dN26aTNGsnr4e1dKpjN0EXWREkYfLJH9HK46MZbh7mC5TV3sdh9BIFG1zQrSey3kZb8mluFvp4ycYfaDBnp3NimLgwOWwpurtlqLTyTksLzuHcSIdr7Z78IV6JF6Z3sl/IaRuZls+AlMOiirCKF1xqnoYzdypxMHs6OrYgxAxIqupYxG4HKtRLO8VYcFAuEi7gCvrp2g+p+LuRbtN0atW1h14a0KG8qXZsVlWkCoOMyA5MoLNsa4nzdnilICJ7ESShuI7gnY30=
  - secure: A1TkKHTphEeJvylQyudXYIIL61ajd0VWVbBk1TT1TzZH/wZP7bj06wqxnBaDqZy23yX8FQ6zGKKluiMGBCy3S97QRjgRwLFNoYB6qjNW8cSscTlY6QIYisoeRLMyWFTzs7pElXCIs97/2xcrCOp+LwBes6ax0uvedDEljzQJK32oUgNYvtV/0JJlAdn/ae99ZQQDCx11N7ydnIvUrRwXskEEXvPm7i3/QoOcN71Mty7F9qtARr4slHJ41TZzBvc4oB5euKRXiEnkBuG4D5CPfOcodTyJLtlz1eaWwgI4KsQ5aWCkFe9va+xqMHhv2Rt/JOMWyMsXp/E48C023Kc11SuvTpv7mOmBvV2X0X6SceFu5zlqn8NIybwHVvr5SkIC+/HSUW2hcOiYP2nTP9G5CbcyS9z6dXKWDKJqvlsMctTibtOlA40YgI4lweAcrkFdgEaw0Evgubw1EvERxMYM5VWFJ5Ewmb8kDa9eeJcrY0v669dvZCa8Trnq34hVVn7FMdCWS6J/y4LtO/2+N8rSI/19R94S+5KE3fkIlYwyfWO089ms2YlfFAhwkWSz8Z72ds6DOEAgEQ9cskEE5PbG4QEpMuHOzCN6VjYc33KIjeHs31Z/eSwgqtfv6eN2FYVKujzKRbsQg6xNW/1uAdo8SKB5z1pjFQ6pZ3Fi/KA3FDQ=
  - secure: ZZ9+2Dhow5ucdbpnW5DfDgqJLveXktQAeMThjJbQZjP2rFKsLW2VOngC4CnF+Ma5KdjTuwwD4UWnlZuwYb0LS9Ac5Ds2/Bx+qDyQOl44XFggringquvJKVDb64b1/P8k6vO1Jjiql6KcJguKfdcm5DTDK6huepm+FqLkN4IZ9CeC84Ul7BT9GHyocBz/KwnGJL8lOsH58fWsOtYOEA/jYYl6MlLbLDMhxNcLwbQtzuChX/M62sbChl6r9KY/Y2g0K/k+VkHlwL8hy4wqwaFz4OflenXOSXutdtK7DXJLHzXOmG+GEimQbRy6uDBYcT5wdfKED1UpaJQlBlgLiYqSfYmJAHUKPukYT0KUHaswZBnZLyboykEALLOt+4uutsUbL9kxVnkhyg1g3l2OuOb+pCa3HVXU4qORRJPpufbRtkbZeE/I3S1RKvMIMTE5UCg+iDValt1agviYyPtm1m2lGeG505H/SYxxJepb/dGoibA6kSHKtPjh4EMVNAykHCpupjc2z7WH2DOoahhY5mUp954GpjdwlxeMZrdMzUf3F3Tvw1lPZXjXyMYkqB97x8A6ggRlEYtmsTvIQYWbqSEXSUqhI6lnqqlKb4hFN3/b8Sf+NIJwlyi2RGKEA8WBgbkai8Q3kmZqp8O3Hm2Vtp8xY0LkxVz/+Hg5UoHcWY5Jipg=
  - secure: HZdlwgVSsp/eeEvs+0Q4JTugcm2crsNWZJ90t5ilTdnVjbWe/7toGRTK8WMHTJ+Bekfwu6gMPou5MazRNyn1qE37mPrujWdpq9ztDVlQTGKMl9xZmwxNzSqgPo48gztfIqatSdoDB42XMoS9XT66tHFI+qqfmO4r+0T2VvGoXJIgm/31W/4S1m1WyZbsXbuoHU7ExiRbiW3+FPy6GUdU8cVyOPm3TZwmZ1xkVyu1xLz3DFP028+P9NZaOyi+lHVPqfx5NPIWZe6X3QLNwwjp0g4nrndSm4711DXrLoEqdCOdFxKrf3BQahm4VmKoe1D7icc0WSGoXcJgn/30hY9fTFh7BBmGVRivKZNlnHUxZ9wa9COHAbXIVPRFdVYoMCuC0esPzTO2SukJEEdZpcENtwikGE8rSppVCUj3ygRqiASfowyK3C7Ldr7wPq/zlck6e+YCqNW/dQEffQtHWQbswlJm8MzulwHhuMKOTk3pxOkofiL5PhbZeMEL5qwZg5wRJ40FtL8F1O1+5QtzzPJZ5C6qSl2S8/nrgUzZbGwVc7l5/47NUQSSzxaLIbH0QChqQNAU0ml4T8gOnvW8m4DXmv976Hm5iyYdTlMyXtVaO4uIAoyOVVjj/jfCoaW2DrS9Ur5gw64S6AnPzvDwpNPo1yDO9qfFKRHM1+THyafCgDI=
  - secure: kN1SAmZxV1+J95fLzxGxHTWeFVjlTexsVhPw4H6L17/kqJl63GP17efz/zmoTXSdNNBc/rVSVdzzy/BgmX9yswGWLQUdEpWuJbPOb7RU6Zqs3x4f0kX0YHenPykZ2SOYTOE0fwuqLC2OpQaCHY6CgiwXhCD0gfRmtQbTFSKpCnU6BISEx17fI7R9XFN8qCQiHPzo3Y5CHV74fEOL60hTfEwH19QXEBPNnPVWRnsm+687PcyYrgXPTf/om4wPRDANvzLorIAXukAE9qzOXeaSa1tocr72+fbSMPlW8loSJ+kW1lIssILZLBdugHumsgx1M8EDRLm4usFHarQlGCrSOFbi9E2fuuiL/tdQL+JFROWV+jp+qZAI72eYU/nTV6Qg6SSJIr86VkBwkoowzEu4qHw/urvB3FqHVLWsVr2So+t1F2lvKdZYxHRLMh9r1/x6wBNnQPO2On4lZAPmGDnenCO7om3X7oRHzAKSCDdmExBzwe1a7reY70WUQ75mBpvshIIausLGEiQyOVU94tddrMDfm4qm6Ndv1d/7lnDZgPl+Sn4GdufjPa7BiBumZuiSpKrFOINGkkRaqhCisQ8KcroJJXcPXc3hQzOwzKXPyI7nZynk8W6+AdRVyIBx8qUZFsqjaagx6nZUpuhK7LpJSHU0tgxs3FzHB5IjwBDv8wk=
  - secure: A0pckG80wSSExXtTcF3Bvufm6vO7LMP79J0qBz8aiLALRY2dN8mNLVBK8v6JLbMm3c5RQExAmrJ8VCPmZdsBazzDdykmkthiSifnFJys5HUuofPi5DvhySTc8waMCeC02hGY5f0keLwOXAQUMLgxKFBbxF+nmrpnqZgmjASuexC+7/3zbZ2JQ3L/fW//DoFxZ9KVA31cKBgw99dIddkfZjP88L7/sEI6ZnLSZgl2qtEw1wKdUD2f56y+eNHr29uA1nFzKZt9qknPush1mvS5a/7EzcwkfQZ816PdRZ2nIo+oh+JyJp1A+RqQDgYYrYznCsEjonmjCCTU32izXtGgOiX13LDBElW3TcX5H4nOLEjIRAsZNyEfdYV0WMMvwjf227tj2YlWOhXEPPwMLXhJ58eKUD72IPr/+WvtLD3s7CQQVKW/tbOnXcf9w8N3BC6LLPp3u8HboOveNgLJoZqB5HkQBh9s+ZrIlgbNEJpArWAMTUd9UktKdvQ5QUQHOO5r1Y19zWwyEaf3MhLC+Lxz+UjEk8AWlrRmwTCKL9IOy8Y4OpC12GDTUyp1M7YtTa92CM/C07fSzrpgQTH6C/1LvgwI2RbwEIxyxeqIioGAV66izvzlwGwYR/ODvHaHGxQCsqTFzhcv9yDk1EFURmC3Ossk4uDpKIXeVyo3hvB9zVE=
  - secure: QQk2zifnldtbVmudCX9LIoQoxccI/GmfnTuIYso6dW+oaGuFpIexgqomFGW27kJVcYKrMRxUY3Z7Uw61Rc4Z95iJFSB3XCY6/BAgutcYt/WMqByNQ6bZNqT8W2XazxqBNskXY4GGlkrTy+kA25n6dJkzYl3RLXUvjqy9vxw9b3nu9qCOZbpuuYXCSp62YcfNl4QPDgulgvzVjgc++Fjj/vEMnc0h1yjYr/LXpebbzWNPUusNgFpahfRlMwIvrxS2DKjm6zyAZJWvImdTT0T6tx9tvcpZ9AsSP6TUYvOl5TfyMllE2ujn8NvhavRQk75VGA0ZO1kSQ41og7i1HM2Cwk/NHE4n/Rw5OthrkxFlmNSBFmJKNwRmJciL3kKhQ0D9Am24s5eoa1rlP4opBvueFdN/hN6gCziJFTokvrBf1/jHCwKLTdQIi3KTMZKN5lmdtVfLyVFQxg62O5epmYicf0GGCaFF8yM8YA94c+AAgjoU2hGVGWi39t6uGWQ1GaV0ZmlUuOhF1egtdVv4eqJtDEPhzb6hA9ulZ7yAf6+ZW+nw6Yt2ldPMcmUoPgrwywGZfN/AaAaW15CHK86DATs3HGAIGWmkFylZVzvLld0IYgLLhATa0IPCCpN74tswDYCZOCAl8E2Yph3YggGPf0p/OB9cx8+0/xM7kbgUIiKNX2U=
