dist: xenial
language: python
python:
- '3.7'
jobs:
  include:
  - language: python
    python: 3.7
    install: "./runCommand.sh init func= lang=python"
    script:
    - "./runCommand.sh test func= lang=python"
  - language: node_js
    node_js: 10
    install: "./runCommand.sh init func= LANG=node.js"
    script:
    - "./runCommand.sh test func= LANG=node.js"
before_deploy:
- cd app/sfr-search-api
- git fetch origin beta-production:beta-production
- git fetch origin development:development
- git archive --format zip --output ../../sfr-search-api-prod.zip beta-production
  ./
- git archive --format zip --output ../../sfr-search-api-dev.zip development ./
- cd ../../
deploy:
- provider: elasticbeanstalk
  skip_cleanup: true
  access_key_id: "$AWS_ACCESS_KEY_ID_PRODUCTION"
  secret_access_key: "$AWS_SECRET_ACCESS_KEY_PRODUCTION"
  region: us-east-1
  app: DigitalResearchBooks-search-api
  env: digital-research-books-api
  bucket_name: elasticbeanstalk-us-east-1-946183545209
  bucket_path: DigitalResearchBooks-search-api
  zip_file: sfr-search-api-prod.zip
  on:
    repo: NYPL/sfr-ingest-pipeline
    branch: beta-production
- provider: elasticbeanstalk
  skip_cleanup: true
  access_key_id: "$AWS_ACCESS_KEY_ID_DEVELOPMENT"
  secret_access_key: "$AWS_SECRET_ACCESS_KEY_DEVELOPMENT"
  region: us-east-1
  app: sfr-search-api
  env: sfr-search-api-dev
  bucket_name: elasticbeanstalk-us-east-1-224280085904
  bucket_path: sfr-search-api-development
  zip_file: sfr-search-api-dev.zip
  on:
    repo: NYPL/sfr-ingest-pipeline
    branch: development
env:
  global:
  - ELASTICSEARCH_INDEX: sfr
  - ELASTICSEARCH_INDEX_V2: sfr_test
  - ELASTICSEARCH_INDEX_V3: sfr_new_v3
  - secure: nYFSPimNy/eqWMCIGhmC4dEhsNnOAuDju/YvuZ5KJ0dglVeQpCjmy3txkRiEUopPOjspJ8hjtTM2HhseRO5j6hqhh9vK1kA9a6n8dyQycd2R1ESJ/f58tDy2JX+5b0W5/be1Bzd7JJYDGKbQDaHV+Y2ZBysN2whrD3wmWN4EdU5upb+QgYrLtU5Mf45y3cNfJNMt5VLIon5AOq5YMhgRd6T+4fvjrd6DdqO3mANH3NfYErslra7DHvWhv2nGxbDgCXXxbMvOruU1zRJ4VJM+7f1Q3ZRHQ6R44LpFWGATL47/QCQxEAY2oPkSxLgIYJINg707980+4Nly9RWNjZTwvR4W9efbM1Vq9CV2nwTYT3emFa1i6VVt9pvBp9kGYrkThmJVEGDWpX0jrNTiwCPoDp+fHejq1yDksaino8DlQ/pVkFFlii4t9sXb0BfxZCoyyyiAXGzYRyVgB0EqwkDVoSDwBIovKK5KGuufqbb/qAk3El+9IuPTgu01Cs3uPw6jNpgvRfxa3sq0B/UDIgP7u7LxRGHshmm62jyLNlIV0O6SOJK9ayKrmYOYu7gekbySCNyN+XdHPtaiVcJddq+N/sS2o2m3SO9/WmNy+hTL/21H9ikFdzZ2T96xTMjbGiG+3kfpnlH4wSvJRmaE0IAmpgsTooly3ogv4teEy34HIdE=
  - secure: Ev/87RPhd1RpgTuVJ69DAz4EfryErAZznabA9Sooj8rF8LT757gmsC2L+IcF0vfeenBgiBOYf9SqqqWVW1TQzhiIM3+3IA+PNfXaB8RzI/vC2lPjk0Nskmom0r/NyHgxiiL8tx+Oo4x0dzdn9CZZ36vq9nL2w9yROJEnprBiDulbhKAMvU+d4jg/O9dOLJnBxzZ81JXavr+1/GNcdQpP4cAukLUCGv9YQ8GZF7V8FT5CMwFL7ahl1iI5fRQgjH+Pfi3sDUkqL5U4D5cAsuSGt4cXnWyO034vf+1qxHwLY6C+dhzk7hRzTRjUfyrJlnQYKOVTZmv/BPUQJWKeZeJzRfxs1eYYL/bIDUS2HPlXEFA5MeYKBQt+IAbY0hTwMSGr4pu+ssFuCG/y8u+FCbPSzvqsV6JggINf6Gft9bQ8FHa7+HY6I6siWs8AxXA/12OTw4DMudYIfUyVCRKmpD4TSUnu17lJ6hsmHcFc7tQtCvR1IEQCMROPiShgNRNeIk9FUO3NXZRYAZX3tHdSXTAmgzmYSIuhJJL6nFLG3Sw5bvoiYzV9JQtLCrxyto31AzHEIuzwfK4q3pn+OSe2Hdvdhg0xjKlbcDCFSfVkKnMGkWEE3lGGu2/aWvfILs8CseTK9b1sMvMFUHHYhV3uIWYHWzPZarRA2yahJEQh4SuD5iE=
  - secure: kmCDyfOs5ix2gT1EeNrtGFmwDFGuc3IIl4OpGOEisdm8b2/sug2dJKP6dG7RGFG1bVWAr2D/0lMh53paiKpuIHA3gzWFvVUE/eblXT6cH9TRBZc3DPsmPeZm8AU+xwIG6NskUi4Q45DFRYvDu9oT/ngMhDyN8Zl1kkU6VnbnSkC14pj/oRslz1Rs5u1PgPAKgcGlrTr1uqyWPrvbmmMbmPt+XqgcGpAk0YdtDyOKNhb7UyVgXhXd6t1DDKbCRLhOhQkezwA2TbFNjdu9ncny8MTY348LmvdHIAiqlvq4VeWkbmdRnvFq4srinFihuKyrlcxjZOGX2GnfShUAklpFlEmWJ6ApwjV0rBu1mK8n2ScmcxGr/v22PL+sOlY2TM0bUwuk23EtVj6VKJ5V67vDTbNeLxxIngPmVJRERQQiQOrLkuqlGokelsnSmdhZ8y1faHQ3eyKFziM3gOvOpZSwLr3+DqPorzpPWPzUAAi7OFw5FpODYqR3ZaRkqXxqMkm2zE+cXkFLrFKrzThnzapxjvGH/28ULB0xtM/hXyVtJfwp6YR55Kkg9CQrqQLX3tlAbvgznEspGaODW5oqyAPVEuZNKjPK4DEY0xPdp5B8aeDYBdwJt3S6xMYHrIj170fguJrhVZncBG/cqrxQwvzGkTkPFJGt/VDOGEoCedRSQ04=
  - secure: oACWzYkQE4lQSGxY06QFmLZB/PgwpjpjtGGp8ZOcm4EUzU9Chh8uModGGQf2h4VGUgtvGEuPtSMi6DK75yi5IFt6iagcj6F1WI7vvGhACr3s3voV+JJ47S/BEBmc5Yjwk7FqvsYLhcR1JQEqptvphxnlnfFMnVC+RMWCfrAlnyrhX613GRZPgOGDKBb2j/OfbiHeCLhHlmazY9DT9+SDiysRvVvt4RhqwgLW5A3sYXp24UlehGYni72CeoHiKww+78P8IJNwA78QmoLcLAVbOZADLDG+XwhkcZBz3evBoTolakfori9vpt3yqr8yy53v0/PKV3csSKuWEByttEda+QWMpCXSI8GqDrjddvs5HYU6PFYLsVZEKH9DY4K0fdr9mWIb7PjN4ZUHfTd5WqPY9KZxD/X17rXt6jmdk9/SbeepJxa9flUCHFNH7TZsNWR13DI2qoebNaNWxuz7D1K2vSY3ue3GQSyaeEKk09LKgmZovFhQ7rIzh6ORFcMMOjy4cXQD9IHDLCYHHMaD8ik+7oB2zqFkB8rE1jGmMwfhXYlHy8pt+BwGGN0iREa06l48Djo9giXasOa9RddRyMCWmVtxbbX5X4M5Qc1PtzdKtOCQKAiwMNhjurTTYJ5wurCJFyrsGfw4Pn6UZM82MZ+w2sRJtzg+5nKvVKZU/lstYDw=
  - secure: Uw+qD18mJwA8dJeVgTKyUae0GLTZXwxUcDFZlUc6LfLjrDivewrSAiYwMsMRsf6VjWhvIX6QQBZdt2V9CSz+z6GY7hEqzAtpzkWzD1jLVW4fiDra0hSm6azD+PvfvVEz+qUt9noZ54DXVpK7AgKcgNfN4EuHCW8ffvW4Idj31m3IldFYGCU1WJq/zGUBtTwLEiC+Gjb5sWWKQ9km95XI4o4qGiYfNf7pBDgQApFHp6v+iaqHSS+UqnqSIKV3YJi6L/92q5Uu3f8PBweg0iur+LzWVe2+Q0bauvAX4FAv2uG13kG/g2plU0aE4/0ODbAhsal7peLr8ek6fxv8JiontKJnBbLaZbj0dbDFwnp0c2Y+v5HA2+HSpOuBQkIJ12xyjZdsSurj2apueYzak1boTns6nZJFYWI4I6xsizbSxvmJaXEvDVG/pKNgFcxD4+CLYIq4SWKdqePr5KHAtJvTH/l1zl0UjaORg0ypKZcltXiYH15ufnH4cAZ3VTbgV7A8HhxVILUZvIJVeEhLCZgWY7liABeaeS9tHcLzBtq3twjW5GIQb3dC4B6CUaq96a9uzU2ugQ4P7ZYfebyhvZK2tjtwk+sfePvVI3pVez+h+xPhxiljN0wUuzrCUe09PaEx20qec31u9ASo2mByfblOJNmXz4mRGcVa76XQO75TYAY=
  - secure: GO6+eC8uQJDd63KIe6vgZ3N1UhtKfkO7uh1zrqAmgTPUjHqtV7SXZCxloUWejmA9jQ76ggqcxVyfEvp2CrmxSmo8ZM0Ea+L1hYpfSTRKklZ8I6+P6UtCbGMe4isUpD7F53MZuY4flwgD9Od8rXgXljbxqr4DZSs0D9jrfG/uIl8DRBTeJ1mAfJzljlsNMpHjT6qPf1LwCEp6C1Pu0HmzMr8HJucs+UMdHPvwba2XhuRQSqeYxEmHckC/86LFOBsPEvfIHzQVTdLYnRL0L3rgNRCXePVWJkxMqTR7lA74djWmBqVlolZ/JjgNOxyhEM7aFs62bg2uEniWhGoKRJ0y2/mQt0oxhLZiV3tA/yexbqVJ/D/jC1noiQKsafC4HFxATLJuMAS+0fwVAXh/kkF0RkCEQ8/mEzkH3F11+WzF9yu4LhLLHDjCLS0lvGUiWdTehmj302sgrhfMhYQZ6l7C7dkq6r8abHos4IVBRzEz9isPPhPk/tpUqT43gC7pApukAeViDX6O6EpUWQV7XDeRRo2n5yHMaTiQ880cdq6vJ9U4Hvc9wbhLGzxrQ6EjP/rXlGwPDXxdV70NxolUE1++0md/l5i6pZVI0uDt3YAAe+AvzUUjczz6IPA+5IaDNfeGPtaLVbq92j0VZOsk823pQo6UtDri9RG2hhl8M723ils=
  - secure: UTf7lHFsIBLMLHrOzZ6kKBJTpZfTW92KhAN4Vea1jCYZZaLCEZhqPOnqudRbFKf4mgelHGvnroBjeeMSSbdw0DWubO1ZuZqHPOUIiYXTfI9n8ntYfJQpGrxS0N74GoZBDu6QgqScDhJ2K0mEqHJEyzHkhaHpd4UuTl1zZseOIepWsIEVywYOpaswxpnkjJ7rFq5gKzs0ASS3pUDFYDqcoNfXxnHR88bt4CJiH9CNcJC315UjOCaq1aGwfH0AwwHxytESxb2sLXRrRGyqyu1TgsalZL+nT/HkkWq/QQL1uWUXlPolQkftqfXcwINBKfMoawvRcflecYy+dJwRn0jVv+VK43i/OlnEU6/lDSqLdvSAZgQ8GKmbuGD7VijPGHvBBPtaUmWDtFihHZugPDk9qcS4cgy3GcfsfPHpLZ9/+hJyYddLCwMU5nP0H9o8bRVcWo+J8AXKrqifqA2TEBPGcV8h83ETMm2hZ0I/S1wYKOTcW1+UEvsxHskz+o44LULtv+V9F7jDfjdck19CPIbBOYmqseJQd+OJjjkjX6dNkK7l5BXYRZ7ey6F6zXML/qarolNBeC5NQh8jju9DJoniZXE4XddHT50fSvpbj8Pfu2wz+oP6fPIyBBQGCkFURqMgI43jkFZxutHtE2nOBQleEfsOvyuTIwtXs+CVCQjUTcw=
